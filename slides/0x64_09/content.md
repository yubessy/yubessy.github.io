# 実装 型推論

0x64物語 第09夜 "型"

Shotaro Tanaka

---

Disclaimer

* 社内勉強会用資料です
* 内容には責任を持ちません

---

～前回までのあらすじ～

---

OCamlでOCaml（のサブセット言語）のREPLを実装

```
TODO
```

---

静的な型システムはまだない

```
TODO
```

---

～本編～

---

1. OCamlでOCamlの対話型インタプリタ（REPL）を実装
2. **できたインタプリタに型推論機構を付与**

---

型推論

> 型推論（かたすいろん）とはプログラミング言語の機能の1つで、静的な型付けを持つ言語において、変数や関数の型を宣言しなくてもそれを導くのに使われた関数の型シグネチャなどから自動的に型を決定する機構のこと。
>
> from 型推論 - Wikipedia

---

(1) プリミティブ演算の型推論

```
1;;
1: int

1 > 0;;
true: bool
```

---

構文木をたどればできる

```

```

---

(2) 関数定義・関数適用の型推論

```
fun x -> x + 1
-: ?
```

---

人間の思考

1. `1` は `int`
2. `+` は `int -> int -> int` だから `x + 1` は `int`
  * ついでに `x` は `int`
3. だからこれは `int -> int`

---

コンピュータのきもち

**誰が `x + 1` を先に見ろといった？？？**

「本体を先に見ればわかる」とかそれ
**`fun f -> fun g -> f g` の前でも言えんの？**

---

ちゃんと（コンピュータにできるように）やる

---

定義

$$
式 e ::= x | n | b | e1 op e2 | fun x -> e | e1 e2
x: 変数
n: 整数
b: 真理値
op: 2項演算子
型 \gamma ::= \alpha | int | bool | \gamma_1 \allow \gamma_2
\alpha: 型変数
$$

---

定義（つづき）

* **型環境** $\Gamma$ : 変数に対して仮定する型に関する情報を保持
  * 変数から型への部分関数とみなせる
  * $\Gamma(x) = int$ のとき x の型は int
* $e : \gamma$ 式 $e$ が型 $\gamma$ をもつという **型判断**

---

型推論アルゴリズム

---

実はまだ話せてないこと：多相性

```
let f = fun x -> x in
  f true && f 1 > 0;;
```

* 同一式の中で `f: bool -> bool` と `f: int -> int` が共存できない

---

力尽きたので詳しく知りたい人はこちらをどうぞ

http://www.fos.kuis.kyoto-u.ac.jp/~t-sekiym/classes/isle4/
